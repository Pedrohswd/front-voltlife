<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <p-toast></p-toast>
            <p-toolbar styleClass="mb-4">
                <ng-template pTemplate="left">
                    <div class="my-2">
                        <button pButton label="Novo Dispositivo" icon="pi pi-plus" style="border-radius:2rem" class="p-button-primary mr-2"
                            (click)="abrirNovoDevice()"></button>
                        <button pButton label="Excluir Selecionados" icon="pi pi-trash" style="border-radius:2rem" class="p-button-danger"
                            (click)="excluirSelecionados()"
                            [disabled]="!devicesSelecionados || !devicesSelecionados.length"></button>
                    </div>
                </ng-template>
                <ng-template pTemplate="right">
                    <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input type="text" pInputText placeholder="Pesquisar" style="border-radius:2rem" class="w-full" />
                    </span>
                </ng-template>
            </p-toolbar>

            <p-table #dt [value]="devices" [(selection)]="devicesSelecionados" dataKey="id" [paginator]="true"
                [rows]="10" [rowsPerPageOptions]="[10,20,30]" [globalFilterFields]="['name','mark','model','category']"
                [rowHover]="true" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem"><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
                        <th pSortableColumn="name">Nome <p-sortIcon field="name"></p-sortIcon></th>
                        <th pSortableColumn="name">Código <p-sortIcon field="code"></p-sortIcon></th>
                        <th pSortableColumn="mark">Marca <p-sortIcon field="mark"></p-sortIcon></th>
                        <th pSortableColumn="model">Modelo <p-sortIcon field="model"></p-sortIcon></th>
                        <th pSortableColumn="voltage">Voltagem <p-sortIcon field="voltage"></p-sortIcon></th>
                        <th pSortableColumn="monthlyConsumption">Mensal (kWh) <p-sortIcon
                                field="monthlyConsumption"></p-sortIcon></th>
                        <th pSortableColumn="annualConsumption">Anual (kWh) <p-sortIcon
                                field="annualConsumption"></p-sortIcon></th>
                        <th pSortableColumn="category">Categoria <p-sortIcon field="category"></p-sortIcon></th>
                        <th>Ações</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-device>
                    <tr>
                        <td><p-tableCheckbox [value]="device"></p-tableCheckbox></td>
                        <td>{{ device.name }}</td>
                        <td>{{ device.code }}</td>
                        <td>{{ device.mark }}</td>
                        <td>{{ device.model }}</td>
                        <td>{{ device.voltage }}</td>
                        <td>{{ device.monthlyConsumption }}</td>
                        <td>{{ device.annualConsumption }}</td>
                        <td>{{ device.category }}</td>
                        <td>
                            <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-primary mr-2"
                                (click)="editarDevice(device)"></button>
                            <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger"
                                (click)="confirmarExclusao(device)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <p-dialog [(visible)]="deviceDialog" [style]="{width: '500px'}" header="Dispositivo"
            [modal]="true" class="p-fluid">
            <form [formGroup]="deviceForm">
                <div class="field">
                    <label for="category">Categoria</label>
                    <p-dropdown inputId="category" [options]="categorias" formControlName="category" optionLabel="label"
                        optionValue="value" placeholder="Selecione"></p-dropdown>
                </div>
                <div class="field">
                    <label for="name">Nome</label>
                    <input id="name" type="text" pInputText formControlName="name" />
                </div>
                <div class="field">
                    <label for="mark">Marca</label>
                    <input id="mark" type="text" pInputText formControlName="mark" />
                </div>
                <div class="field">
                    <label for="model">Modelo</label>
                    <input id="model" type="text" pInputText formControlName="model" />
                </div>
                <div class="formgrid grid">
                    <div class="field col">
                        <label for="voltage">Voltagem (V)</label>
                        <p-inputNumber inputId="voltage" formControlName="voltage"></p-inputNumber>
                    </div>
                    <div class="field col">
                        <label for="monthly">Consumo Mensal</label>
                        <p-inputNumber inputId="monthly" formControlName="monthlyConsumption"></p-inputNumber>
                    </div>
                </div>
                <div class="field">
                    <label for="annual">Consumo Anual</label>
                    <p-inputNumber inputId="annual" formControlName="annualConsumption"></p-inputNumber>
                </div>
            </form>
            <ng-template pTemplate="footer">
                <button pButton label="Cancelar" icon="pi pi-times" class="p-button-rounded p-button-primary mr-2"
                    (click)="fecharDialog()"></button>
                <button pButton label="Salvar" icon="pi pi-check" class="p-button-rounded p-button-primary mr-2"
                    (click)="salvarDevice()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="deleteDeviceDialog" header="Confirmar" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span *ngIf="device">Tem certeza que deseja excluir <b>{{device.name}}</b>?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton icon="pi pi-times" class="p-button-rounded p-button-primary mr-2" label="Não"
                    (click)="deleteDeviceDialog = false"></button>
                <button pButton icon="pi pi-check" class="p-button-rounded p-button-primary mr-2" label="Sim"
                    (click)="confirmarDeleteDevice()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="deleteDevicesDialog" header="Confirmar" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span>Tem certeza que deseja excluir os dispositivos selecionados?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton icon="pi pi-times" class="p-button-rounded p-button-primary mr-2" label="Não"
                    (click)="deleteDevicesDialog = false"></button>
                <button pButton icon="pi pi-check" class="p-button-rounded p-button-primary mr-2" label="Sim"
                    (click)="confirmarDeleteSelecionados()"></button>
            </ng-template>
        </p-dialog>
    </div>
</div>